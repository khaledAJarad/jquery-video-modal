!function(a,b,c){function d(b,c){this.element=b,a(this.element).data("videoModal",this),this.options=a.extend({},f,c),this._is_playing=!1,this._is_playing_rendered=!0,this._is_open=!1,this._is_open_rendered=!0,this.scrub_portion=0,this._render_interval=-1,this.ui_container=a(this.element).find(".controls")[0],this.video=a(this.element).find("video")[0],this.init()}var e="videoModal",f={themeClass:"video-modal-theme-default",mouseHideDelay:3e3};d.prototype={init:function(){a(this.element).addClass(this.options.themeClass),this.initListeners(),this.render()},initListeners:function(){var d=this,e=a(this.video).attr("poster");a("<img/>").attr("src",e).load(function(){a(d.video).data("measured",!0),a(d.video).data("image-width",this.width),a(d.video).data("image-height",this.height),a(d.video).attr("data-image-width",this.width),a(d.video).attr("data-image-height",this.height),d.render()}),a(this.ui_container).find(".play").bind("click",function(a){a.preventDefault(),d.play()}),a(this.ui_container).find(".pause").bind("click",function(a){a.preventDefault(),d.pause()}),a(this.ui_container).find(".close").bind("click",function(a){a.preventDefault(),d.close()}),a(this.ui_container).find(".scrub").bind("mousedown",function(a){a.preventDefault(),d._is_scrubbing=!0,d._onScrub(a)}),a(this.ui_container).bind("mousemove",function(a){d._is_scrubbing&&d._onScrub(a),d._is_open&&d._onMouseMove()}),a(c).bind("mouseup",function(a){a.preventDefault(),d._is_scrubbing&&(d._is_scrubbing=!1,d._onScrub(a))}),a(b).bind("resize",function(){d.render()}),a(c).bind("keyup",function(a){d._is_open&&(32==a.keyCode?d._is_playing?d.pause():d.play():27==a.keyCode&&d.close())})},pause:function(){0!=this._is_playing&&(this._is_playing=!1,clearInterval(this._render_interval),this.render())},play:function(){if(1!=this._is_playing){this._is_playing=!0,this.render();var a=this;clearInterval(this._render_interval),this._render_interval=setInterval(function(){a.render()},100),this._onMouseMove()}},close:function(){0!=this._is_open&&(this._is_playing=!1,this._is_open=!1,clearInterval(this._render_interval),this.render())},open:function(a){1!=this._is_open&&(this._is_open=!0,a?(this.scrubTo(0),this.play()):this.render())},scrubTo:function(a){this.scrub_portion=a,this.video.currentTime=this.scrub_portion*this.video.duration,this.render()},_onScrub:function(b){var c=a(this.ui_container).find(".scrub").offset(),d=parseInt(a(this.ui_container).find(".scrub .marker").css("margin-left")),e=b.clientX-c.left-d,f=e/a(this.ui_container).find(".scrub").width();f=Math.max(0,Math.min(1,f)),this.scrubTo(f)},_onMouseMove:function(){this._mouse_idle=!1;var a=this;clearInterval(this._idle_interval),this._idle_interval=setInterval(function(){a._mouse_idle=!0,a.render()},this.options.mouseHideDelay),a.render()},render:function(){if(this._is_open_rendered!=this._is_open&&(this._is_open_rendered=this._is_open,this._is_open?a(this.element).show():a(this.element).hide()),this._is_playing_rendered!=this._is_playing&&(this._is_playing_rendered=this._is_playing,this._is_playing?(a(this.ui_container).find(".pause").show(),a(this.ui_container).find(".play").hide(),this.video.play()):(a(this.ui_container).find(".pause").hide(),a(this.ui_container).find(".play").show(),this.video.pause())),this._is_scrubbing){var b=a(this.ui_container).find(".scrub").width()*this.scrub_portion;a(this.ui_container).find(".scrub .marker").width(b+"px")}else{this.play_portion=this.video.currentTime/this.video.duration;var b=a(this.ui_container).find(".scrub").width()*this.play_portion;a(this.ui_container).find(".scrub .marker").width(b+"px"),this._mouse_idle&&1==this._is_playing?a(this.ui_container).addClass("hide"):a(this.ui_container).removeClass("hide")}1==a(this.video).data("measured")&&this.renderFill()},renderFill:function(){var c=a(this.video).data("image-width"),d=a(this.video).data("image-height"),e=a(b).width(),f=a(b).height(),g=e/c,h=f/d,i=Math.max(g,h),j=i*c,k=i*d,l=.5*(e-j),m=.5*(f-k);a(this.video).width(j),a(this.video).height(k),a(this.video).css("margin-left",l),a(this.video).css("margin-top",m)}},a.fn[e]=function(b){return this.each(function(){a.data(this,"plugin_"+e)||a.data(this,"plugin_"+e,new d(this,b))})}}(jQuery,window,document);